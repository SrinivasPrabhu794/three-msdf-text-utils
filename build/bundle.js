!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).bundle={},t.three)}(this,(function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&s(t,e)}function a(t){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},a(t)}function s(t,e){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},s(t,e)}function u(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=a(t);if(e){var r=a(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return u(this,n)}}var h={exports:{}};!function(t){var e=/\n/,n="\n",i=/\s/;function r(t,e,n,i){var r=t.indexOf(e,n);return-1===r||r>i?i:r}function o(t){return i.test(t)}function a(t,e,n,i){return{start:e,end:e+Math.min(i,n-e)}}t.exports=function(e,n){return t.exports.lines(e,n).map((function(t){return e.substring(t.start,t.end)})).join("\n")},t.exports.lines=function(t,i){if(0===(i=i||{}).width&&"nowrap"!==i.mode)return[];t=t||"";var s="number"==typeof i.width?i.width:Number.MAX_VALUE,u=Math.max(0,i.start||0),l="number"==typeof i.end?i.end:t.length,h=i.mode,f=i.measure||a;return"pre"===h?function(t,n,i,r,o){for(var a=[],s=i,u=i;u<r&&u<n.length;u++){var l=n.charAt(u),h=e.test(l);if(h||u===r-1){var f=t(n,s,h?u:u+1,o);a.push(f),s=u+1}}return a}(f,t,u,l,s):function(t,e,i,a,s,u){var l=[],h=s;"nowrap"===u&&(h=Number.MAX_VALUE);for(;i<a&&i<e.length;){for(var f=r(e,n,i,a);i<f&&o(e.charAt(i));)i++;var c=t(e,i,f,h),p=i+(c.end-c.start),d=p+n.length;if(p<f){for(;p>i&&!o(e.charAt(p));)p--;if(p===i)d>i+n.length&&d--,p=d;else for(d=p;p>i&&o(e.charAt(p-n.length));)p--}if(p>=i){var v=t(e,i,p,h);l.push(v)}i=d}return l}(f,t,u,l,s,h)}}(h);var f=h.exports,c=["x","e","a","o","n","s","r","c","u","m","v","w","z"],p=["m","w"],d=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],v="\t".charCodeAt(0),g=" ".charCodeAt(0),y=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,t),this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(e)}return r(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"descender",get:function(){return this._descender}},{key:"ascender",get:function(){return this._ascender}},{key:"xHeight",get:function(){return this._xHeight}},{key:"baseline",get:function(){return this._baseline}},{key:"capHeight",get:function(){return this._capHeight}},{key:"lineHeight",get:function(){return this._lineHeight}},{key:"linesTotal",get:function(){return this._linesTotal}},{key:"lettersTotal",get:function(){return this._lettersTotal}},{key:"update",value:function(t){var e=this;if(t=Object.assign({measure:this._measure},t),this._options=t,this._options.tabSize=x(this._options.tabSize,4),!t.font)throw new Error("must provide a valid bitmap font");var n=this.glyphs,i=t.text||"",r=t.font;this._setupSpaceGlyphs(r);var o=f.lines(i,t),a=t.width||0;n.length=0;var s=o.reduce((function(t,e){return Math.max(t,e.width,a)}),0),u=0,l=0,h=x(t.lineHeight,r.common.lineHeight),p=r.common.base,v=h-p,g=t.letterSpacing||0,y=h*o.length-v,m=function(t){if("center"===t)return 1;if("right"===t)return 2;return 0}(this._options.align);l-=y,this._width=s,this._height=y,this._descender=h-p,this._baseline=p,this._xHeight=function(t){for(var e=0;e<c.length;e++){var n=c[e].charCodeAt(0),i=w(t.chars,n);if(i>=0)return t.chars[i].height}return 0}(r),this._capHeight=function(t){for(var e=0;e<d.length;e++){var n=d[e].charCodeAt(0),i=w(t.chars,n);if(i>=0)return t.chars[i].height}return 0}(r),this._lineHeight=h,this._ascender=h-v-this._xHeight,o.forEach((function(t,o){for(var a,f=t.start,c=t.end,p=t.width,d=t.end-t.start,v=f;v<c;v++){var y=i.charCodeAt(v),w=e.getGlyph(r,y);if(w){a&&(u+=b(r,a.id,w.id));var x=u;1===m?x+=(s-p)/2:2===m&&(x+=s-p),e._options.textIndent&&0===o&&(x+=e._options.textIndent),n.push({position:[x,l],data:w,index:v,line:o,lineLettersTotal:d}),u+=w.xadvance+g,a=w}}l+=h,u=0})),this._lettersTotal=n.length,this._linesTotal=o.length}},{key:"getGlyph",value:function(t,e){var n=m(t,e);return n||(e===v?this._fallbackTabGlyph:e===g?this._fallbackSpaceGlyph:null)}},{key:"computeMetrics",value:function(t,e,n,i){var r,o,a=this._options.letterSpacing||0,s=this._options.font,u=0,l=0,h=0;if(!s.chars||0===s.chars.length)return{start:e,end:e,width:0};n=Math.min(t.length,n);for(var f=e;f<n;f++){var c=t.charCodeAt(f);if(r=this.getGlyph(s,c)){r.char=t[f],r.xoffset;var p=(u+=o?b(s,o.id,r.id):0)+r.xadvance+a,d=u+r.width;if(d>=i||p>=i)break;u=p,l=d,o=r}h++}return o&&(l+=o.xoffset),{start:e,end:e+h,width:l}}},{key:"_setupSpaceGlyphs",value:function(t){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,t.chars&&0!==t.chars.length){var e=m(t,g)||function(t){for(var e=0;e<p.length;e++){var n=p[e].charCodeAt(0),i=w(t.chars,n);if(i>=0)return t.chars[i]}return 0}(t)||t.chars[0],n=this._options.tabSize*e.xadvance;this._fallbackSpaceGlyph=e;var i=Object.assign({},e);this._fallbackTabGlyph=Object.assign(i,{x:0,y:0,xadvance:n,id:v,xoffset:0,yoffset:0,width:0,height:0})}}}]),t}();function m(t,e){if(!t.chars||0===t.chars.length)return null;var n=w(t.chars,e);return n>=0?t.chars[n]:null}function b(t,e,n){if(!t.kernings||0===t.kernings.length)return 0;for(var i=t.kernings,r=0;r<i.length;r++){var o=i[r];if(o.first===e&&o.second===n)return o.amount}return 0}function w(t,e,n){for(var i=n=n||0;i<t.length;i++)if(t[i].id===e)return i;return-1}function x(t,e){return"number"==typeof t?t:"number"==typeof e?e:0}var _={min:[0,0],max:[0,0]};function A(t){var e=t.length/2;_.min[0]=t[0],_.min[1]=t[1],_.max[0]=t[0],_.max[1]=t[1];for(var n=0;n<e;n++){var i=t[2*n+0],r=t[2*n+1];_.min[0]=Math.min(i,_.min[0]),_.min[1]=Math.min(r,_.min[1]),_.max[0]=Math.max(i,_.max[0]),_.max[1]=Math.max(r,_.max[1])}}var O={computeBox:function(t,e){return A(t),e.min.set(_.min[0],_.min[1],0),e.max.set(_.max[0],_.max[1],0),e},computeSphere:function(t,e){A(t);var n=_.min[0],i=_.min[1],r=_.max[0]-n,o=_.max[1]-i,a=Math.sqrt(r*r+o*o);e.center.set(n+r/2,i+o/2,0),e.radius=a/2}};var T={pages:function(t){var e=new Float32Array(4*t.length*1),n=0;return t.forEach((function(t){var i=t.data.page||0;e[n++]=i,e[n++]=i,e[n++]=i,e[n++]=i})),e},attributes:function(t,e,n,i,r){var o=new Float32Array(4*t.length*2),a=new Float32Array(4*t.length*2),s=new Float32Array(4*t.length*2),u=new Float32Array(4*t.length*2),l=0,h=0,f=0,c=0;return t.forEach((function(t){var p=t.data,d=p.x+p.width,v=p.y+p.height,g=p.x/e,y=p.y/n,m=d/e,b=v/n;i&&(y=(n-p.y)/n,b=(n-v)/n),o[l++]=g,o[l++]=y,o[l++]=g,o[l++]=b,o[l++]=m,o[l++]=b,o[l++]=m,o[l++]=y,a[c++]=t.position[0]/r.width,a[c++]=(t.position[1]+r.height)/r.height,a[c++]=t.position[0]/r.width,a[c++]=(t.position[1]+r.height+p.height)/r.height,a[c++]=(t.position[0]+p.width)/r.width,a[c++]=(t.position[1]+r.height+p.height)/r.height,a[c++]=(t.position[0]+p.width)/r.width,a[c++]=(t.position[1]+r.height)/r.height;var w=t.position[0]+p.xoffset,x=t.position[1]+p.yoffset,_=p.width,A=p.height;s[h++]=w,s[h++]=x,s[h++]=w,s[h++]=x+A,s[h++]=w+_,s[h++]=x+A,s[h++]=w+_,s[h++]=x,u[f++]=w+_/2,u[f++]=x+A/2,u[f++]=w+_/2,u[f++]=x+A/2,u[f++]=w+_/2,u[f++]=x+A/2,u[f++]=w+_/2,u[f++]=x+A/2})),{uvs:o,layoutUvs:a,positions:s,centers:u}},infos:function(t,e){for(var n=new Float32Array(4*t.length),i=new Float32Array(4*t.length),r=new Float32Array(4*t.length),o=new Float32Array(4*t.length),a=new Float32Array(4*t.length),s=0,u=0,l=0,h=0,f=0,c=0,p=-1,d=0;d<t.length;d++){var v=t[d];i[s++]=v.line,i[s++]=v.line,i[s++]=v.line,i[s++]=v.line,r[u++]=v.index,r[u++]=v.index,r[u++]=v.index,r[u++]=v.index,a[h++]=v.lineLettersTotal,a[h++]=v.lineLettersTotal,a[h++]=v.lineLettersTotal,a[h++]=v.lineLettersTotal,p===v.line?c++:c=0,p=v.line,o[l++]=c,o[l++]=c,o[l++]=c,o[l++]=c,n[f++]=v.wordIndex,n[f++]=v.wordIndex,n[f++]=v.wordIndex,n[f++]=v.wordIndex}return{words:n,lines:i,letters:r,lineLetters:o,lineLettersTotal:a}}},L=Object.prototype.toString;function S(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}var k=function(t){switch(t){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}},I=function(t){return t.BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===L.call(t.buffer)||Array.isArray(t)}
/*!
   * Determine if an object is a Buffer
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   */,M=function(t){return null!=t&&(S(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&S(t.slice(0,0))}(t)||!!t._isBuffer)},B=[0,2,3],D=[2,1,3],j=function(t){o(a,t);var i=l(a);function a(t){var e;return n(this,a),"string"==typeof t&&(t={text:t}),(e=i.call(this))._options=Object.assign({},t),e._layout=null,e._visibleGlyphs=[],e.update(e._options),e}return r(a,[{key:"layout",get:function(){return this._layout}},{key:"visibleGlyphs",get:function(){return this._visibleGlyphs}},{key:"update",value:function(t){if(t=this._validateOptions(t)){this._layout=function(t){return new y(t)}(t);for(var n=!1!==t.flipY,i=t.font,r=i.common.scaleW,o=i.common.scaleH,a=0,s=0;s<this._layout.glyphs.length;s++){var u=this._layout.glyphs[s].data;this._layout.glyphs[s].wordIndex=a," "===u.char&&a++}var l=this._layout.glyphs.filter((function(t){var e=t.data;return e.width*e.height>0}));this._visibleGlyphs=l;var h=T.attributes(l,r,o,n,this._layout),f=T.infos(l,this._layout),c=function(t,e){t&&(I(t)||M(t))||(e=t||{},t=null);for(var n="string"==typeof(e="number"==typeof e?{count:e}:e||{}).type?e.type:"uint16",i="number"==typeof e.count?e.count:1,r=e.start||0,o=!1!==e.clockwise?B:D,a=o[0],s=o[1],u=o[2],l=6*i,h=t||new(k(n))(l),f=0,c=0;f<l;f+=6,c+=4){var p=f+r;h[p+0]=c+0,h[p+1]=c+1,h[p+2]=c+2,h[p+3]=c+a,h[p+4]=c+s,h[p+5]=c+u}return h}([],{clockwise:!0,type:"uint16",count:l.length});if(this.setIndex(c),this.setAttribute("position",new e.BufferAttribute(h.positions,2)),this.setAttribute("center",new e.BufferAttribute(h.centers,2)),this.setAttribute("uv",new e.BufferAttribute(h.uvs,2)),this.setAttribute("layoutUv",new e.BufferAttribute(h.layoutUvs,2)),this.setAttribute("word",new e.BufferAttribute(f.words,1)),!t.multipage&&"page"in this.attributes)this.deleteAttribute("page");else if(t.multipage){var p=T.pages(l);this.setAttribute("page",new e.BufferAttribute(p,1))}}}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new e.Sphere);var t=this.attributes.position.array,n=this.attributes.position.itemSize;if(!t||!n||t.length<2)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);O.computeSphere(t,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new e.Box3);var t=this.boundingBox,n=this.attributes.position.array,i=this.attributes.position.itemSize;if(n&&i&&!(n.length<2))return O.computeBox(n,t);t.makeEmpty()}},{key:"_validateOptions",value:function(t){if("string"==typeof t&&(t={text:t}),!(t=Object.assign({},this._options,t)).font)throw new TypeError("must specify a { font } in options");return t}}]),a}(e.BufferGeometry),F={side:e.FrontSide,transparent:!0,defines:{IS_SMALL:!1},extensions:{derivatives:!0},uniforms:{uOpacity:{value:1},uColor:{value:new e.Color("#ffffff")},uMap:{value:null},uThreshold:{value:0},uAlphaTest:{value:0},uOutlineColor:{value:new e.Color("#ffffff")},uOutlineOutsetWidth:{value:0},uOutlineInsetWidth:{value:0}},vertexShader:"#define GLSLIFY 1\nattribute vec2 layoutUv;attribute float line;attribute float letter;attribute float lineLetters;attribute float lineLettersTotal;varying vec2 vUv;varying vec2 vLayoutUv;varying vec3 vViewPosition;varying vec3 vNormal;varying float vLineIndex;varying float vLetterIndex;varying float vLineLetterIndex;varying float vLineLettersTotal;void main(){vec4 mvPosition=vec4(position,1.0);mvPosition=modelViewMatrix*mvPosition;gl_Position=projectionMatrix*mvPosition;vUv=uv;vLayoutUv=layoutUv;vViewPosition=-mvPosition.xyz;vNormal=normal;vLineIndex=line;vLetterIndex=letter;vLineLetterIndex=lineLetters;vLineLettersTotal=lineLettersTotal;}",fragmentShader:"#define GLSLIFY 1\nvarying vec2 vUv;uniform float uOpacity;uniform float uThreshold;uniform float uAlphaTest;uniform vec3 uColor;uniform sampler2D uMap;uniform vec3 uOutlineColor;uniform float uOutlineOutsetWidth;uniform float uOutlineInsetWidth;float median(float r,float g,float b){return max(min(r,g),min(max(r,g),b));}void main(){vec3 s=texture2D(uMap,vUv).rgb;float sigDist=median(s.r,s.g,s.b)-0.5;float sigDistOutset=sigDist+uOutlineOutsetWidth*0.5;float sigDistOutset2=sigDist+(0.5)*0.5;float sigDistInset=sigDist-uOutlineInsetWidth*0.5;\n#ifdef IS_SMALL\nfloat afwidth=1.4142135623730951/2.0;float alpha=smoothstep(uThreshold-afwidth,uThreshold+afwidth,sigDist);float outset=smoothstep(uThreshold-afwidth,uThreshold+afwidth,sigDistOutset);float outset2=smoothstep(uThreshold-afwidth,uThreshold+afwidth,sigDistOutset2);float inset=1.0-smoothstep(uThreshold-afwidth,uThreshold+afwidth,sigDistInset);\n#else\nfloat alpha=clamp(sigDist/fwidth(sigDist)+0.5,0.0,1.0);float outset=clamp(sigDistOutset/fwidth(sigDistOutset)+0.5,0.0,1.0);float outset2=clamp(sigDistOutset2/fwidth(sigDistOutset2)+0.5,0.0,1.0);float inset=1.0-clamp(sigDistInset/fwidth(sigDistInset)+0.5,0.0,1.0);\n#endif\nfloat border=outset*inset;if(alpha<uAlphaTest)discard;vec4 filledFragColor=vec4(uColor,uOpacity*alpha);vec4 strokedFragColor=vec4(uOutlineColor,uOpacity*border);gl_FragColor=filledFragColor;}"},C=function(t){o(i,t);var e=l(i);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,i),t=Object.assign(F,t),e.call(this,t)}return r(i)}(e.ShaderMaterial);t.MSDFTextGeometry=j,t.MSDFTextMaterial=C,Object.defineProperty(t,"__esModule",{value:!0})}));
